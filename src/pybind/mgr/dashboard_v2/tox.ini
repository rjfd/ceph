[tox]
envlist = cov-init,py27,py3,cov-report,lint
skipsdist = true

[testenv]
deps=-r{toxinidir}/requirements.txt
setenv=
    UNITTEST=true
    WEBTEST_INTERACTIVE=false
    COVERAGE_FILE= .coverage.{envname}
    PYTHONPATH = {toxinidir}/../../../../build/lib/cython_modules/lib.3:{toxinidir}/../../../../build/lib/cython_modules/lib.2
    LD_LIBRARY_PATH = {toxinidir}/../../../../build/lib
commands=
    {envbindir}/py.test --cov=. --cov-report= --junitxml=junit.{envname}.xml tests/

[testenv:cov-init]
setenv =
    COVERAGE_FILE = .coverage
deps = coverage
commands =
    coverage erase

[testenv:cov-report]
setenv =
    COVERAGE_FILE = .coverage
deps = coverage
commands =
    coverage combine
    coverage report
    coverage xml

[testenv:lint]
setenv =
    PYTHONPATH = {toxinidir}/../../../../build/lib/cython_modules/lib.3:{toxinidir}/../../../../build/lib/cython_modules/lib.2
    LD_LIBRARY_PATH = {toxinidir}/../../../../build/lib
deps=-r{toxinidir}/requirements.txt
commands=
    pylint --rcfile=.pylintrc --jobs=5 . module.py tools.py controllers tests cephmock
    pycodestyle --max-line-length=100 --exclude=python2.7,.tox,venv,frontend .
